<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>井字遊戲</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 調整這裡的數值來改變遊戲板的大小 */
            --board-size: 600px; 
            --cell-size: calc(var(--board-size) / 4);
            --x-color: #54d1fa;
            --o-color: #f1bf43;
            --bg-color: #1a2a33;
            --dark-color: #121c22;
            --text-color: #d1d1d1;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }

        h1 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 3rem; /* 放大標題 */
        }

        #score-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            width: var(--board-size);
            margin-bottom: 15px;
        }

        .score-box {
            background-color: var(--dark-color);
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            text-align: center;
            flex-grow: 1;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 2px solid transparent;
        }
        
        #score-box-x.active-player {
            transform: scale(1.05);
            border-color: var(--x-color);
            box-shadow: 0 0 20px rgba(84, 209, 250, 0.4);
        }

        #score-box-o.active-player {
            transform: scale(1.05);
            border-color: var(--o-color);
            box-shadow: 0 0 20px rgba(241, 191, 67, 0.4);
        }


        .player-id {
            font-size: 1.1rem; /* 放大字體 */
            display: block;
            margin-bottom: 5px;
        }

        #score-x, #score-o {
            font-size: 2rem; /* 放大分數 */
            font-weight: bold;
        }

        #score-x {
            color: var(--x-color);
        }

        #score-o {
            color: var(--o-color);
        }

        #status-container {
            margin-bottom: 20px;
            padding: 10px 20px;
            background-color: var(--dark-color);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            width: var(--board-size);
            box-sizing: border-box;
        }

        #status {
            font-size: 1.8rem; /* 放大狀態文字 */
            font-weight: bold;
            min-height: 30px;
        }
        
        #game-board {
            display: grid;
            grid-template-columns: repeat(4, var(--cell-size));
            grid-template-rows: repeat(4, var(--cell-size));
            gap: 10px;
            background-color: var(--bg-color);
            padding: 10px;
            border-radius: 12px;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background-color: var(--dark-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .cell:hover {
            background-color: #2c3e4a;
        }

        .winning-cell {
            animation: win-animation 0.8s ease-in-out;
        }

        @keyframes win-animation {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background-color: #3e5362; }
            100% { transform: scale(1); }
        }

        @keyframes fade-in {
            to { opacity: 1; }
        }

        #restart-button {
            margin-top: 25px;
            padding: 15px 30px; /* 放大按鈕 */
            font-size: 1.2rem; /* 放大按鈕文字 */
            font-weight: bold;
            color: var(--bg-color);
            background-image: linear-gradient(45deg, var(--x-color), var(--o-color));
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #restart-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        #instructions {
            margin-top: 20px;
            font-size: 1rem; /* 放大說明文字 */
            color: #a0a0a0;
            max-width: var(--board-size);
        }
    </style>
</head>
<body>
    <h1>井字遊戲</h1>
    <div id="score-container">
        <div class="score-box" id="score-box-x">
            <span class="player-id">玩家 X</span>
            <span id="score-x">0</span>
        </div>
        <div class="score-box" id="score-box-o">
            <span class="player-id">玩家 O</span>
            <span id="score-o">0</span>
        </div>
    </div>
    <div id="status-container">
        <div id="status">第 1 回合</div>
    </div>
    <div id="game-board">
        <div class="cell" data-index="0"></div>
        <div class="cell" data-index="1"></div>
        <div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div>
        <div class="cell" data-index="4"></div>
        <div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div>
        <div class="cell" data-index="7"></div>
        <div class="cell" data-index="8"></div>
        <div class="cell" data-index="9"></div>
        <div class="cell" data-index="10"></div>
        <div class="cell" data-index="11"></div>
        <div class="cell" data-index="12"></div>
        <div class="cell" data-index="13"></div>
        <div class="cell" data-index="14"></div>
        <div class="cell" data-index="15"></div>
    </div>
    <button id="restart-button">手動重置</button>
    <p id="instructions">遊戲目標是讓自己的四個符號（X 或 O）連成一線（橫、直或斜線）。</p>

    <script>
        const statusDisplay = document.getElementById('status');
        const cells = document.querySelectorAll('.cell');
        const restartButton = document.getElementById('restart-button');
        const scoreXDisplay = document.getElementById('score-x');
        const scoreODisplay = document.getElementById('score-o');
        const scoreBoxX = document.getElementById('score-box-x');
        const scoreBoxO = document.getElementById('score-box-o');

        const rootStyles = getComputedStyle(document.documentElement);
        const xColor = rootStyles.getPropertyValue('--x-color').trim();
        const oColor = rootStyles.getPropertyValue('--o-color').trim();

        let gameActive = true;
        let currentPlayer = 'X';
        let gameState = Array(16).fill("");
        let scoreX = 0;
        let scoreO = 0;
        let roundCount = 1;

        const winningMessage = () => `玩家 ${currentPlayer} 獲勝!`;
        const drawMessage = () => `平手!`;
        const currentRoundText = () => `第 ${roundCount} 回合`;

        const winningConditions = [
            // 橫
            [0, 1, 2, 3],
            [4, 5, 6, 7],
            [8, 9, 10, 11],
            [12, 13, 14, 15],
            // 直
            [0, 4, 8, 12],
            [1, 5, 9, 13],
            [2, 6, 10, 14],
            [3, 7, 11, 15],
            // 斜
            [0, 5, 10, 15],
            [3, 6, 9, 12]
        ];

        function handleCellPlayed(clickedCell) {
            if (currentPlayer === 'X') {
                clickedCell.innerHTML = `
                    <svg viewBox="0 0 100 100" style="width: 70%; height: 70%; opacity: 0; animation: fade-in 0.3s forwards;">
                        <line x1="15" y1="15" x2="85" y2="85" stroke="${xColor}" stroke-width="12" stroke-linecap="round" />
                        <line x1="85" y1="15" x2="15" y2="85" stroke="${xColor}" stroke-width="12" stroke-linecap="round" />
                    </svg>`;
            } else {
                clickedCell.innerHTML = `
                    <svg viewBox="0 0 100 100" style="width: 70%; height: 70%; opacity: 0; animation: fade-in 0.3s forwards;">
                        <circle cx="50" cy="50" r="38" stroke="${oColor}" stroke-width="12" fill="none" stroke-linecap="round" />
                    </svg>`;
            }
        }

        function updateScores() {
            if (currentPlayer === 'X') {
                scoreX++;
                scoreXDisplay.textContent = scoreX;
            } else {
                scoreO++;
                scoreODisplay.textContent = scoreO;
            }
        }

        function updatePlayerHighlight() {
            scoreBoxX.classList.toggle('active-player', gameActive && currentPlayer === 'X');
            scoreBoxO.classList.toggle('active-player', gameActive && currentPlayer === 'O');
        }
        
        function handlePlayerChange() {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            statusDisplay.textContent = currentRoundText();
            updatePlayerHighlight();
        }

        function handleResultValidation() {
            let roundWon = false;
            let winningCombo = [];
            for (let i = 0; i < winningConditions.length; i++) {
                const winCondition = winningConditions[i];
                const [a, b, c, d] = winCondition.map(index => gameState[index]);

                if (a === '' || b === '' || c === '' || d === '') {
                    continue;
                }
                if (a === b && b === c && c === d) {
                    roundWon = true;
                    winningCombo = winCondition;
                    break;
                }
            }

            if (roundWon) {
                statusDisplay.textContent = winningMessage();
                gameActive = false;
                updateScores();
                updatePlayerHighlight();
                winningCombo.forEach(index => {
                    cells[index].classList.add('winning-cell');
                });
                setTimeout(startNewRound, 2000); // 2秒後自動重啟
                return;
            }

            let roundDraw = !gameState.includes("");
            if (roundDraw) {
                statusDisplay.textContent = drawMessage();
                gameActive = false;
                updatePlayerHighlight();
                setTimeout(startNewRound, 2000); // 2秒後自動重啟
                return;
            }

            handlePlayerChange();
        }

        function handleCellClick(event) {
            const clickedCell = event.currentTarget;
            const clickedCellIndex = parseInt(clickedCell.getAttribute('data-index'));

            if (gameState[clickedCellIndex] !== "" || !gameActive) {
                return;
            }
            
            gameState[clickedCellIndex] = currentPlayer;
            handleCellPlayed(clickedCell);
            handleResultValidation();
        }



        function startNewRound() {
            roundCount++;
            gameActive = true;
            // 下一局由上一局的輸家先開始，或平手時交換玩家
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            gameState = Array(16).fill("");
            statusDisplay.textContent = currentRoundText();
            cells.forEach(cell => {
                cell.innerHTML = '';
                cell.classList.remove('winning-cell');
            });
            updatePlayerHighlight();
        }
        
        function manualRestart() {
            roundCount = 1;
            scoreX = 0;
            scoreO = 0;
            scoreXDisplay.textContent = scoreX;
            scoreODisplay.textContent = scoreO;
            currentPlayer = 'X'; // 每次手動重置都由 X 開始
            startNewRound();
            roundCount = 1; // startNewRound increments it, so reset to 1
            statusDisplay.textContent = currentRoundText();

        }

        cells.forEach(cell => cell.addEventListener('click', handleCellClick));
        restartButton.addEventListener('click', manualRestart);

        statusDisplay.textContent = currentRoundText();
        updatePlayerHighlight();
    </script>
</body>
</html>

